<form class="ui form" (ngSubmit)="onSubmitAddRequirement(this)" #formAddRequirement="ngForm">
    <div class="fields">
            <div class="five wide field">
                <div class="field">
                    <label>{{ 'requirement_name' | translate }}</label>
                    <input
                        name="name"
                        [disabled]="newRequirement.type !== 'service'"
                        auto-complete
                        autocomplete="off"
                        type="text"
                        required
                        pattern="[a-zA-Z0-9\.]*"
                        placeholder="{{'requirement_placeholder_name_' + newRequirement.type | translate}}"
                        [source]="suggest"
                        [min-chars]="3"
                        [(ngModel)]="newRequirement.name"
                        [no-match-found-text]="false">
                        <div *ngIf="!formAddRequirement.valid && !formAddRequirement.pristine" class="ui error message">
                            <p>{{'requirement_name_error' | translate}}</p>
                        </div>
                </div>
            </div>
            <div class="three wide field">
                <div class="field">
                    <label>{{ 'requirement_type' | translate }}</label>
                    <sm-select class="search"
                        *ngIf="availableRequirements.length > 0"
                        (onChange)="selectType()"
                        [(model)]="newRequirement.type"
                        [options]="{'fullTextSearch': true}"
                        placeholder="{{ 'requirement_type' | translate }}">
                        <option *ngFor="let r of availableRequirements" value="{{r}}">{{r}}</option>
                    </sm-select>
                </div>
            </div>
            <div class="five wide field">
                <div *ngIf="newRequirement.type !== 'model'">
                    <div class="field">
                        <label>{{ 'requirement_value' | translate }}</label>
                        <input
                            name="value"
                            auto-complete
                            autocomplete="off"
                            type="text"
                            [source]="suggest"
                            [min-chars]="3"
                            [(ngModel)]="newRequirement.value"
                            (keyup)="setName()"
                            placeholder="{{'requirement_placeholder_value_' + newRequirement.type | translate}}"
                            [no-match-found-text]="false">
                    </div>
                </div>
                <div *ngIf="!loading && (newRequirement.type === 'model' || newRequirement.type === 'service')">
                    <div class="field" *ngIf="newRequirement.type === 'model'">
                        <label>{{'requirement_placeholder_value_' + newRequirement.type | translate}}</label>
                        <sm-select
                            class="search"
                            [(model)]="newRequirement.value"
                            [options]="{'fullTextSearch': true}"
                            (onChange)="setName();"
                            placeholder="{{'requirement_placeholder_value_' + newRequirement.type | translate}}">
                            <option *ngFor="let m of workerModels" [value]="m.name">{{m.name}} ({{m.type}})</option>
                        </sm-select>
                    </div>

                    <div class="field" *ngIf="newRequirement.type === 'model'">
                        <label>{{'requirement_manual_value' | translate}}</label>
                        <input
                            name="value"
                            auto-complete
                            autocomplete="off"
                            type="text"
                            [source]="suggest"
                            [min-chars]="3"
                            [(ngModel)]="newRequirement.value"
                            (keyup)="setName()"
                            placeholder="{{'requirement_placeholder_value_' + newRequirement.type | translate}}"
                            [no-match-found-text]="false">
                    </div>
                    <p *ngIf="newRequirement.type === 'model' && newRequirement.value !== ''">
                        <a class="ui" [routerLink]="['/settings', 'worker-model', newRequirement.value]">
                            {{ 'requirement_settings_worker_model' | translate }} {{ newRequirement.value }}
                        </a>
                    </p>
                    <label for="opts">
                        {{ 'requirement_options' | translate }}
                    </label>
                    <textarea
                        name="opts"
                        [(ngModel)]="newRequirement.opts"
                        rows="3"
                        placeholder="{{'requirement_placeholder_opts_' + newRequirement.type | translate}}"></textarea>
                </div>
            </div>
            <div class="three wide center field">
                <button class="ui blue icon button" (click)="onSubmitAddRequirement(formAddRequirement)" [disabled]="!formAddRequirement.valid"><i class="plus icon"></i></button>
            </div>
    </div>
    <p>
        <i class="fa fa-book"></i>
        <a href="https://ovh.github.io/cds/building-pipelines/building-pipelines.requirements/">
        {{ 'requirement_documentation' | translate }} </a>
    </p>
    <p [innerHtml]="getHelp()"></p>
</form>
